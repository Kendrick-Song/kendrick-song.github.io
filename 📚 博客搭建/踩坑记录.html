<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>踩坑记录 | Kendrick Song&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon1.ico">
    <meta name="description" content="Kendrick Song 的个人学习记录">
    
    <link rel="preload" href="/assets/css/0.styles.e4b140e1.css" as="style"><link rel="preload" href="/assets/js/app.eff809b3.js" as="script"><link rel="preload" href="/assets/js/2.40f6092e.js" as="script"><link rel="preload" href="/assets/js/26.c44e79fd.js" as="script"><link rel="prefetch" href="/assets/js/10.5cf72e5a.js"><link rel="prefetch" href="/assets/js/11.82765383.js"><link rel="prefetch" href="/assets/js/12.98a5bce1.js"><link rel="prefetch" href="/assets/js/13.3d644110.js"><link rel="prefetch" href="/assets/js/14.f6824e06.js"><link rel="prefetch" href="/assets/js/15.5a1b5285.js"><link rel="prefetch" href="/assets/js/16.09e6cc02.js"><link rel="prefetch" href="/assets/js/17.0045c85b.js"><link rel="prefetch" href="/assets/js/18.5bf37711.js"><link rel="prefetch" href="/assets/js/19.2bd01e0a.js"><link rel="prefetch" href="/assets/js/20.9e98d054.js"><link rel="prefetch" href="/assets/js/21.3fe8bc1b.js"><link rel="prefetch" href="/assets/js/22.cd328ac5.js"><link rel="prefetch" href="/assets/js/23.3a654b05.js"><link rel="prefetch" href="/assets/js/24.bd7923e1.js"><link rel="prefetch" href="/assets/js/25.3ee67490.js"><link rel="prefetch" href="/assets/js/3.1c8b2be8.js"><link rel="prefetch" href="/assets/js/4.7142b3c2.js"><link rel="prefetch" href="/assets/js/5.925a501d.js"><link rel="prefetch" href="/assets/js/6.cc3d141c.js"><link rel="prefetch" href="/assets/js/7.78711d70.js"><link rel="prefetch" href="/assets/js/8.b5ad8aaf.js"><link rel="prefetch" href="/assets/js/9.920d1f47.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4b140e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Kendrick Song's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/💯 算法刷题/数据结构/链表相关.html" class="nav-link">
  💯 算法刷题
</a></div><div class="nav-item"><a href="/🐳 Docker/Docker 入门/Docker 概述.html" class="nav-link">
  🐳 Docker
</a></div><div class="nav-item"><a href="/📚 博客搭建/构建 VuePress 容器镜像.html" class="nav-link">
  📚 博客搭建
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/💻 从零开始配置一台工作电脑-Mac.html" class="nav-link">
  💻 从零开始配置一台工作电脑-Mac
</a></li><li class="dropdown-item"><!----> <a href="/📄 简历编写指南.html" class="nav-link">
  📄 简历编写指南
</a></li></ul></div></div> <a href="https://github.com/Kendrick-Song/kendrick-song.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/💯 算法刷题/数据结构/链表相关.html" class="nav-link">
  💯 算法刷题
</a></div><div class="nav-item"><a href="/🐳 Docker/Docker 入门/Docker 概述.html" class="nav-link">
  🐳 Docker
</a></div><div class="nav-item"><a href="/📚 博客搭建/构建 VuePress 容器镜像.html" class="nav-link">
  📚 博客搭建
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/💻 从零开始配置一台工作电脑-Mac.html" class="nav-link">
  💻 从零开始配置一台工作电脑-Mac
</a></li><li class="dropdown-item"><!----> <a href="/📄 简历编写指南.html" class="nav-link">
  📄 简历编写指南
</a></li></ul></div></div> <a href="https://github.com/Kendrick-Song/kendrick-song.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>📚 博客搭建</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/📚 博客搭建/构建 VuePress 容器镜像.html" class="sidebar-link">构建 VuePress 容器镜像</a></li><li><a href="/📚 博客搭建/VuePress 相关配置.html" class="sidebar-link">VuePress 相关配置</a></li><li><a href="/📚 博客搭建/VuePress 部署.html" class="sidebar-link">VuePress 部署</a></li><li><a href="/📚 博客搭建/踩坑记录.html" class="active sidebar-link">踩坑记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#容器内对挂载文件夹使用-mv-命令导致主机对应文件全部被删除-😭" class="sidebar-link">容器内对挂载文件夹使用 mv 命令导致主机对应文件全部被删除 😭</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#问题描述" class="sidebar-link">问题描述</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#问题定位" class="sidebar-link">问题定位</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#解决方案" class="sidebar-link">解决方案</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#经验总结" class="sidebar-link">经验总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#由-lastupdated-无效发现的-docker-容器内-git-仓库跨文件系统问题" class="sidebar-link">由 lastUpdated 无效发现的 Docker 容器内 Git 仓库跨文件系统问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#问题描述-2" class="sidebar-link">问题描述</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#问题定位-2" class="sidebar-link">问题定位</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#解决方案-2" class="sidebar-link">解决方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#lastupdated-时区修改" class="sidebar-link">lastUpdated 时区修改</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#问题描述-3" class="sidebar-link">问题描述</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#问题定位-3" class="sidebar-link">问题定位</a></li><li class="sidebar-sub-header"><a href="/📚 博客搭建/踩坑记录.html#解决方案-3" class="sidebar-link">解决方案</a></li></ul></li></ul></li><li><a href="/📚 博客搭建/相关参考.html" class="sidebar-link">相关参考</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="踩坑记录"><a href="#踩坑记录" class="header-anchor">#</a> 踩坑记录</h1> <p></p><div class="table-of-contents"><ul><li><a href="#容器内对挂载文件夹使用-mv-命令导致主机对应文件全部被删除-😭">容器内对挂载文件夹使用 mv 命令导致主机对应文件全部被删除 😭</a><ul><li><a href="#问题描述">问题描述</a></li><li><a href="#问题定位">问题定位</a></li><li><a href="#解决方案">解决方案</a></li><li><a href="#经验总结">经验总结</a></li></ul></li><li><a href="#由-lastupdated-无效发现的-docker-容器内-git-仓库跨文件系统问题">由 lastUpdated 无效发现的 Docker 容器内 Git 仓库跨文件系统问题</a><ul><li><a href="#问题描述">问题描述</a></li><li><a href="#问题定位">问题定位</a></li><li><a href="#解决方案">解决方案</a></li></ul></li><li><a href="#lastupdated-时区修改">lastUpdated 时区修改</a><ul><li><a href="#问题描述">问题描述</a></li><li><a href="#问题定位">问题定位</a></li><li><a href="#解决方案">解决方案</a></li></ul></li></ul></div><p></p> <h2 id="容器内对挂载文件夹使用-mv-命令导致主机对应文件全部被删除-😭"><a href="#容器内对挂载文件夹使用-mv-命令导致主机对应文件全部被删除-😭" class="header-anchor">#</a> 容器内对挂载文件夹使用 <code>mv</code> 命令导致主机对应文件全部被删除 😭</h2> <div class="custom-block danger"><p class="custom-block-title">时刻牢记</p> <p>在容器内除被挂载的目录外，其他任何操作（新建/删除/修改）都不会被持久化！</p> <p>风险操作前一定记得备份！</p></div> <h3 id="问题描述"><a href="#问题描述" class="header-anchor">#</a> 问题描述</h3> <p>起因是我在把博客部署到 Github 上的时候，由于仓库名称和本地项目目录名称不同，导致构建好的静态页面会因为路径问题没有办法在 Github Pages 上正常显示。</p> <p>解决方法很简单，就是每次部署的时候都需要在 <code>docs/.vuepress/config.js</code> 中设置正确的 <code>base</code>，具体参考 <a href="https://vuepress.vuejs.org/zh/guide/deploy.html#github-pages" target="_blank" rel="noopener noreferrer">部署 | VuePress (vuejs.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。<s>部署完成后需要注释掉，否则本地构建会失败。</s><strong>（后来发现不注释掉也可以正常构建，不知道在哪看的文章深深的误导了我 ，不然我也不会踩到后面这个大坑😭）</strong></p> <p>每次想部署到 Github 上都要改一下这个配置，感觉很麻烦，我就想「能不能把项目根目录的名字改的和仓库一样，这样就省的每次改配置了」。于是乎我就在容器内用 <code>mv</code> 命令将项目根目录名称给改了，结果<strong>容器直接停止运行</strong>。</p> <p>这时候我还觉得一切还 OK，可能就是不能改吧，<code>mv</code> 操作失败，重启容器就好了。一重启发现容器起不来了，查日志提示项目目录下找不到 <code>package.json</code> 文件。</p> <p>那就新开一个容器呗？但是<strong>手贱的我不只新开了一个容器，还把原来的容器给删掉了…</strong>，给后面文档找不回来埋下伏笔。</p> <p>新开的容器可以跑起来，但是定睛一看：哎？我文档呢？怎么是空的？</p> <p>这个时候我已经预感不妙：不会刚才 <code>mv</code> 操作已经把项目文件给操作了吧？我赶紧回到我宿主机挂载文档的目录看一眼，果不其然，<strong>所有文档全没了…</strong></p> <h3 id="问题定位"><a href="#问题定位" class="header-anchor">#</a> 问题定位</h3> <p>我开始逐一实验排查文档消失前的每一步操作，最终定位到了 <code>mv</code> 命令这一步。</p> <p>为了方便文档同步，查看部署效果，我在启动容器时将容器内的 <code>docs</code> 文件夹和宿主机的文档文件夹设置了绑定挂载（bind mounts），使得这两个文件夹的内容是<strong>实时同步</strong>的，这样我就可以在宿主机编写文档，还能时刻查看部署效果。</p> <p>正常使用都没什么问题，但是当我使用 <code>mv</code> 命令对容器内项目根目录更名时，问题出现了。 <code>mv</code> 命令对文件夹进行更名实际上大致是以下几个步骤：</p> <ol><li>创建目标文件夹；</li> <li>将原文件夹内所有内容复制到目标文件夹；</li> <li>删除原文件夹及其内容。</li></ol> <p><strong>问题就出现在这里！</strong></p> <p>虽然 <code>mv</code> 命令最终失败了，但是提示的是我挂载的目录被占用了，无法被删除，也就意味着除了这个目录本身以外的内容，全都已经被移动到了目标文件夹中（经过实验测试的确是这样的），而原文件夹只剩下了挂载目录这一个空壳。</p> <p>所以我们现在来捋一下这个问题发生的过程：</p> <ol><li><p>用 <code>mv</code> 命令对项目文件夹更名，项目文件夹内有挂载到主机的目录，导致 <code>mv</code> 命令报错：无法删除，但除目录外的文件均已移动到新文件夹；</p></li> <li><p><strong>因为宿主机和容器的挂载目录是同步的，所以宿主机对应的内容也被删除了。</strong></p></li> <li><p>因为项目文件被移走了，导致 VuePress 进程异常退出，容器关闭；</p></li> <li><p><strong>因为容器内的文件操作是不会被持久化的，所以容器删除后那些文档就消失了。</strong></p></li></ol> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h3> <p>不幸的是这些文档是肯定找不回来了，不幸中的万幸是在这之前我已经把它们部署到 Github 上了，内容都在，只是得重新搞一下格式。</p> <h3 id="经验总结"><a href="#经验总结" class="header-anchor">#</a> 经验总结</h3> <ul><li>时刻备份重要文件，尤其是在风险操作之前。</li> <li>同 <code>rm</code> 命令类似，<code>mv</code> 命令也是一个具有破坏性的命令，如果使用不当，很可能给系统带来灾难性的后果。</li></ul> <h2 id="由-lastupdated-无效发现的-docker-容器内-git-仓库跨文件系统问题"><a href="#由-lastupdated-无效发现的-docker-容器内-git-仓库跨文件系统问题" class="header-anchor">#</a> 由 <code>lastUpdated</code> 无效发现的 Docker 容器内 Git 仓库跨文件系统问题</h2> <h3 id="问题描述-2"><a href="#问题描述-2" class="header-anchor">#</a> 问题描述</h3> <p>在进行默认主题配置的 <a href="https://vuepress.vuejs.org/zh/theme/default-theme-config.html#%E6%9C%80%E5%90%8E%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4" target="_blank" rel="noopener noreferrer">最后更新时间<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 相关配置时，配置完成后发现没有效果，于是开始排查问题。在 <a href="https://vuepress.vuejs.org/zh/theme/default-theme-config.html#%E6%9C%80%E5%90%8E%E6%9B%B4%E6%96%B0%E6%97%B6%E9%97%B4" target="_blank" rel="noopener noreferrer">官方文档中<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 有如下提示：</p> <blockquote><p>使用须知</p> <p>由于 <code>lastUpdated</code> 是基于 <code>git</code> 的, 所以你只能在一个基于 <code>git</code> 的项目中启用它。此外，由于使用的时间戳来自 git commit，因此它将仅在给定页的第一次提交之后显示，并且仅在该页面后续提交更改时更新。</p></blockquote> <p>它提示了这个功能依赖于 Git 项目的时间戳，但是没有特别明确的说明这个 Git 仓库根目录应该在哪里。按照我个人理解，只要相关文档被 Git 跟踪到并 commit 过，就能够获取到对应的时间戳了。所以我将整个 <code>/vuepress</code> 作为 Git 仓库的根目录，并 commit 了所有的更改。但页面中并没有显示最后更新时间。</p> <blockquote><p>这里在根目录建立仓库也是为了方便后续的集成部署。</p></blockquote> <h3 id="问题定位-2"><a href="#问题定位-2" class="header-anchor">#</a> 问题定位</h3> <p>既然最后更新没有显示出来，在其他配置都没问题的情况下（实际上就其他配置也就是在 <code>config.js</code> 里面加了个字段），就证明文档的 Git 时间戳没有被正确的获取到。</p> <p>我首先进到容器里面，在 <code>/vuepress</code> 目录下执行 <code>git log</code> 命令，发现日志是正常的，时间戳也都在，并且用 <code>git log docs</code> 和 <code>git log docs/README.md</code> 打印对应文档的 log 也都一切正常。</p> <p><strong>哎？这就奇了怪了，这该有的都有啊，怎么显示不出来呢？难道是因为仓库的路径问题？</strong></p> <p>顺着这个思路我重新设置 Git 仓库，将仓库建在了 <code>/docs</code> 文件夹下，并提交。</p> <p><strong>哎？这怎么又可以了？！这不应该啊，为什么一定要在 <code>vuepress/docs</code> 目录才行啊？</strong></p> <p>按理来说在 <code>/vuepress</code> 目录下建仓库 Git 是肯定会跟踪到 <code>vuepress/docs</code> 目录的啊，在之前也测试过 log 的输出都一切正常啊。</p> <p>于是我又在 <code>/vuepress</code> 目录下新建仓库进行测试，这次我先进入到 <code>vuepress/docs</code> 目录下，再执行 <code>git log</code> 命令。</p> <p><strong>哎！问题出现了！</strong></p> <p>终端给出了报错：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@xxx:/vuepress/docs<span class="token comment"># git log</span>
fatal: not a <span class="token function">git</span> repository <span class="token punctuation">(</span>or any parent up to <span class="token function">mount</span> point /vuepress<span class="token punctuation">)</span>
Stopping at filesystem boundary <span class="token punctuation">(</span>GIT_DISCOVERY_ACROSS_FILESYSTEM not <span class="token builtin class-name">set</span><span class="token punctuation">)</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>它告诉我们说这里没有 Git 仓库。这就有点不合理了，明明 commit 的时候都跟踪到了相关文件的。</p> <p><strong>用第一行报错信息去搜索</strong>，都是告诉要初始化仓库的，这显然不是这个问题的场景。</p> <p><strong>用第二行报错信息去搜索</strong>，找到了关于此报错的 <a href="https://stackoverflow.com/a/62461735" target="_blank" rel="noopener noreferrer">相关解释<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，大致意思是说 Git 需要访问另一个文件系统，默认权限下它被阻挡在了文件系统边界，无法访问，如果确实需要跨文件系统，需要设置 <code>GIT_DISCOVERY_ACROSS_FILESYSTEM</code> 环境变量为 1。</p> <p>**因为我们在启动容器时对 <code>vuepress/docs</code> 目录做了绑定挂载，把它挂载到了宿主机的对应目录中，**所以出现了跨文件系统的需求，导致了报错信息的出现。</p> <div class="custom-block tip"><p class="custom-block-title">详细过程</p> <p>在 <code>vuepress/</code> 创建的仓库，其 <code>.git</code> 文件夹是在 <code>vuepress</code> 目录下，里面存储着仓库所有相关信息，包括变更历史、当前分支以及 Git 跟踪的所有其他信息。在执行 Git 命令的时候，Git 第一件事就是找 <code>.git</code> 文件夹，它会从当前目录开始向上层递归查找，当前目录没有就去父目录，父目录没有就去父目录的父目录，以此类推，直到不能再访问了为止。如果没有找到，证明这不是一个合法的仓库，就会报错（如上文提到的一样）。</p> <p>所以，在  <code>/vuepress</code> 目录下执行  <code>git logs docs</code> 输出正常证明了 <code>/vuepress/.git</code> 文件跟踪了 <code>/vuepress/docs</code> 文件的相关变化。</p> <p>在 <code>vuepress/test</code> 目录下执行 Git 命令，Git 在本目录没有找到  <code>.git</code> 文件夹，然后去父目录也就是 <code>vuepress/</code> 目录找，成功找到后命令就可以被正确执行。</p> <p>但是，在进入到 <code>/vuepress/docs</code> 目录后，<strong>因为我们将该目录挂载到了宿主机目录，所以此时操作的文件系统是宿主机的文件系统。</strong></p></div> <h3 id="解决方案-2"><a href="#解决方案-2" class="header-anchor">#</a> 解决方案</h3> <p>因为需要添加全局环境变量，所以得重新运行容器，在启动参数里面加上环境变量。</p> <p>先 <code>docker commit</code> 将当前容器提交为一个镜像，保存我们在容器内做的改动，比如 Git 相关的设置。</p> <p>再 <code>docker run</code> 基于刚才的镜像实例化一个容器，在参数中添加环境变量，具体如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\</span>
	<span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token punctuation">\</span>
    <span class="token parameter variable">--name</span> add_env <span class="token punctuation">\</span>
    <span class="token parameter variable">-e</span> <span class="token assign-left variable">GIT_DISCOVERY_ACROSS_FILESYSTEM</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--mount</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,src<span class="token operator">=</span>/Users/kendrick_song/Documents/📒,target<span class="token operator">=</span>/vuepress/docs <span class="token punctuation">\</span>
    kendrick-song/vuepress-base:2.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行 <code>docker exec</code> 命令进入容器 bash，进入目录 <code>/vuepress/docs</code> 并再次尝试 <code>git log</code>，已经可以正常显示，没有报错。</p> <p>在浏览器中查看，文档底部也已经显示出了最后更新时间。</p> <h2 id="lastupdated-时区修改"><a href="#lastupdated-时区修改" class="header-anchor">#</a> lastUpdated 时区修改</h2> <h3 id="问题描述-3"><a href="#问题描述-3" class="header-anchor">#</a> 问题描述</h3> <p>页面底部显示的最后更新时间时区不是中国时区。</p> <h3 id="问题定位-3"><a href="#问题定位-3" class="header-anchor">#</a> 问题定位</h3> <p>lastUpdated 是基于 Git 时间戳来设定文档最后更新时间的，我们先进入容器 bash 并执行 <code>git log</code> 命令，发现显示的 Date 确实不是中国时区的时间。</p> <h3 id="解决方案-3"><a href="#解决方案-3" class="header-anchor">#</a> 解决方案</h3> <p>修改 Git 日志的时区为特定时区可以参考 <a href="https://stackoverflow.com/a/15103333" target="_blank" rel="noopener noreferrer">此回答<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，大体需要以下几个步骤：</p> <ol><li>定义环境变量 <code>TZ='Asia/Shanghai'</code>，这一步需要在容器启动时进行配置，后续在 bash 中配置的是临时变量，并不会在 VuePress 运行环境中生效；</li> <li>配置时区永久生效 <code>git config --global log.date local</code>。</li> <li>重启容器，lastUpdated 不具备热部署的能力。</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Kendrick-Song/kendrick-song.github.io/edit/main/docs/📚 博客搭建/踩坑记录.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2023/7/9 14:31:20</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/📚 博客搭建/VuePress 部署.html" class="prev">
        VuePress 部署
      </a></span> <span class="next"><a href="/📚 博客搭建/相关参考.html">
        相关参考
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.eff809b3.js" defer></script><script src="/assets/js/2.40f6092e.js" defer></script><script src="/assets/js/26.c44e79fd.js" defer></script>
  </body>
</html>
