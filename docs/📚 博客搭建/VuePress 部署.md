# VuePress éƒ¨ç½²

[[toc]]

## éƒ¨ç½²åˆ° Github Pages

### åˆ›å»ºè¿œç¨‹ä»“åº“

åœ¨ [GitHub](https://github.com/) ä¸­æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åç§°è¿™é‡Œè¾“å…¥ `username.github.io` ä½œä¸ºå­˜å‚¨åº“åç§°ã€‚ å°† `username` æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·åã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·åä¸º `octocat`ï¼Œåˆ™å­˜å‚¨åº“åç§°åº”ä¸º `octocat.github.io`ã€‚

::: tip æ³¨æ„

å¦‚æœä½ æ‰“ç®—å°†åšå®¢å‘å¸ƒåˆ° `https://<USERNAME>.github.io/`ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§ä¸Šè¿°æ­¥éª¤è¿›è¡Œé…ç½®ï¼›

å¦‚æœä½ æ‰“ç®—å°†åšå®¢å‘å¸ƒåˆ° `https://<USERNAME>.github.io/<REPO>/`ï¼ˆä¹Ÿå°±æ˜¯è¯´ä½ çš„ä»“åº“åœ¨ `https://github.com/<USERNAME>/<REPO>`ï¼‰ï¼Œåˆ™å°†ä»“åº“åç§°æ”¹ä¸º `<REPO>`ï¼Œå¹¶åœ¨ `config.js` ä¸­å°† `base` è®¾ç½®ä¸º `"/<REPO>/"`ã€‚

:::

è¿™ä¸ªä»“åº“å°±æ˜¯æˆ‘ä»¬åšå®¢çš„ä»“åº“ï¼Œå…¶åº”å½“æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œåœ¨åç»­ push æ—¶å°½é‡éµä»ï¼š

- mainï¼šå­˜å‚¨é¡¹ç›®æ‰€æœ‰çš„æ–‡ä»¶ï¼Œé™¤æ„å»ºæ–‡ä»¶ï¼ˆæ¯”å¦‚ `dist`ï¼‰ï¼›
- deployï¼šåšå®¢çš„éƒ¨ç½²åˆ†æ”¯ï¼Œç”¨äº Github Pages çš„å±•ç¤ºï¼Œå­˜æ”¾é¡¹ç›®çš„æ„å»ºåæ–‡ä»¶ã€‚

### åˆ›å»ºæœ¬åœ°ä»“åº“

::: warning æ³¨æ„

æˆ‘ä»¬åœ¨å®¹å™¨å†…çš„æ‰€æœ‰æœ¬åœ°æ“ä½œï¼Œéƒ½ä»…é™äºå½“å‰å®¹å™¨ã€‚åŸºäºç›¸åŒé•œåƒæ–°å»ºçš„å®¹å™¨æ˜¯æ²¡æœ‰æˆ‘ä»¬åç»­æ“ä½œäº§ç”Ÿçš„ä»»ä½•æ–‡ä»¶çš„ã€‚è¡€æ³ªæ•™è®­ï¼š[å®¹å™¨å†…å¯¹æŒ‚è½½æ–‡ä»¶å¤¹ä½¿ç”¨ `mv` å‘½ä»¤å¯¼è‡´ä¸»æœºå¯¹åº”æ–‡ä»¶å…¨éƒ¨è¢«åˆ é™¤ ğŸ˜­](./è¸©å‘è®°å½•.md#å®¹å™¨å†…å¯¹æŒ‚è½½æ–‡ä»¶å¤¹ä½¿ç”¨-mv-å‘½ä»¤å¯¼è‡´ä¸»æœºå¯¹åº”æ–‡ä»¶å…¨éƒ¨è¢«åˆ é™¤-ğŸ˜­)

å¦‚æœæ‹…å¿ƒå“ªä¸€å¤©è¿™ä¸ªå®¹å™¨è¢«ç©åäº†ï¼Œä»é•œåƒæ–°å»ºå®¹å™¨è¿˜è¦å†æ¥ä¸€éç›¸åŒçš„æ­¥éª¤ï¼Œè§‰å¾—éº»çƒ¦ï¼Œå¯ä»¥åœ¨æ“ä½œå®Œä»¥ä¸‹æ­¥éª¤åç”¨ `docker commit` å‘½ä»¤å°†è¿™ä¸ªå®¹å™¨çš„æœ¬åœ°æ“ä½œæäº¤ä¸ºä¸€ä¸ªé•œåƒï¼Œè¿™å°±ç›¸å½“äºç»™å®¹å™¨æ‹äº†ä¸ªå¿«ç…§ï¼Œä»¥åå¯ä»¥ä»è¿™ä¸ªæ–°é•œåƒæ–°å»ºå®¹å™¨ã€‚

:::

#### é…ç½® Git

ç”¨ `docker exec` å‘½ä»¤è¿›å…¥å®¹å™¨çš„ bashï¼Œæ ¹æ® [Git - åˆæ¬¡è¿è¡Œ Git å‰çš„é…ç½® (git-scm.com)](https://git-scm.com/book/zh/v2/èµ·æ­¥-åˆæ¬¡è¿è¡Œ-Git-å‰çš„é…ç½®) ä¸­**ç”¨æˆ·ä¿¡æ¯**ä¸€èŠ‚è®¾ç½®ä½ çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€ã€‚

::: danger é‡è¦

è®¾ç½®ä½ çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºæ¯ä¸€ä¸ª Git æäº¤éƒ½ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼Œå®ƒä»¬ä¼šå†™å…¥åˆ°ä½ çš„æ¯ä¸€æ¬¡æäº¤ä¸­ï¼Œä¸å¯æ›´æ”¹ã€‚

:::

```bash
$ git config --global user.name "John Doe"
$ git config --global user.email johndoe@example.com
```

è®¾ç½®å®Œæˆåå¯ä»¥é€šè¿‡ `git config --list` ç¡®è®¤è®¾ç½®æ­£ç¡®ã€‚

#### é€šè¿‡ SSH è¿æ¥åˆ° GitHub

æ²¡æœ‰äººå¸Œæœ›è‡ªå·±çš„ä»“åº“å¯ä»¥è¢«å…¶ä»–äººéšæ„ä¿®æ”¹ï¼Œå½“æˆ‘ä»¬ push åˆ°è¿œç¨‹ä»“åº“æ—¶ï¼ŒGithub ä¼šé€šè¿‡ SSHï¼ˆå®‰å…¨å¤–å£³åè®®ï¼‰æ£€æŸ¥æˆ‘ä»¬å½“å‰æ˜¯å¦æœ‰æƒé™å¯¹ä»“åº“è¿›è¡Œä¿®æ”¹ã€‚

æ‰€ä»¥å¯¹äºä¸€ä¸ªæ–°æœºå™¨ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆå®ƒçš„ SSH å¯†é’¥å¯¹ï¼Œå¹¶å°†å…¬é’¥æ·»åŠ åˆ° GitHub è´¦æˆ·ä¸­ä»¥å¯ç”¨è¿™å°æœºå™¨å¯¹ Github å¸æˆ·çš„ SSH è®¿é—®ã€‚

1. è¾“å…¥ `ls -al ~/.ssh` ä»¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç°æœ‰çš„ SSH å¯†é’¥å¯¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒGitHub çš„ä¸€ä¸ªæ”¯æŒçš„å…¬é’¥çš„æ–‡ä»¶åæ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š

   - id_rsa.pub
   - id_ecdsa.pub
   - id_ed25519.pub

   ::: tip æç¤º

   å¦‚æœæ”¶åˆ°é”™è¯¯ï¼ŒæŒ‡ç¤º `~/.ssh` ä¸å­˜åœ¨ï¼Œåˆ™è¡¨æ˜é»˜è®¤ä½ç½®ä¸­æ²¡æœ‰ç°æœ‰çš„ SSH å¯†é’¥å¯¹ã€‚ æ‚¨å¯ä»¥åœ¨ä¸‹ä¸€æ­¥ä¸­åˆ›å»ºæ–°çš„ SSH å¯†é’¥å¯¹ã€‚

   :::

2. è‹¥æ²¡æœ‰å¯†é’¥å¯¹ï¼Œä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„ GitHub ç”µå­é‚®ä»¶åœ°å€ï¼‰ï¼Œè¿™å°†ä»¥æä¾›çš„ç”µå­é‚®ä»¶åœ°å€ä¸ºæ ‡ç­¾åˆ›å»ºæ–° SSH å¯†é’¥ï¼š

   ```sh
   $ ssh-keygen -t ed25519 -C "your_email@example.com"
   ```

   æ‰§è¡Œåä¸€è·¯å›è½¦å³å¯ã€‚
   
3. æŸ¥çœ‹ SSH å…¬é’¥ï¼Œå¹¶å¤åˆ¶ä¸‹æ¥ï¼š

   ```bash
   $ cat ~/.ssh/id_ed25519.pub
   ```

4. åœ¨ Github ä¸­å•å‡»å³ä¸Šè§’ä¸ªäººèµ„æ–™ç…§ç‰‡ â†’ Settings â†’ è¾¹æ ä¸­é€‰æ‹©ã€ŒSSH å’Œ GPG å¯†é’¥ã€â†’ ã€ŒNew SSH keyã€è¿›å…¥åˆ°æ·»åŠ  SSH key çš„é¡µé¢ã€‚ç²˜è´´å…¬é’¥å¹¶è®¾ç½®å¯¹åº” Titleï¼Œæ¯”å¦‚ ã€Œä¸ªäººç¬”è®°æœ¬ç”µè„‘ã€ã€‚

è‡³æ­¤æˆ‘ä»¬ SSH ç›¸å…³é…ç½®å°±å®Œæˆäº†ã€‚

#### åˆ›å»ºæœ¬åœ°ä»“åº“

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆ`/vuepress`ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–æœ¬åœ°ä»“åº“ï¼š

```bash
$ git init
```

æ–°å»º `.gitignore` æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼š

```bash
# -e å‚æ•°ï¼šå¯ç”¨è½¬ä¹‰ç¬¦å·
$ touch .gitignore && echo -e 'node_modules\ndist\n.DS_Store' >> .gitignore
$ cat .gitignore
node_modules
dist
```

ä½¿ç”¨ `git add -A` å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œ`git commit -m 'first commit'` æäº¤ä¿®æ”¹ã€‚

è®¾ç½®è¿œç¨‹ä»“åº“ï¼š

```bash
$ git remote add origin git@github.com:<USERNAME>/<USERNAME/REPO>.github.io.git
```

æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š

```bash
$ git push -u origin master:main
```

> `-u`  å‚æ•°å…¶å®å°±ç›¸å½“äºè®°å½•äº† push åˆ°è¿œç«¯åˆ†æ”¯çš„é»˜è®¤å€¼ï¼Œè¿™æ ·å½“ä¸‹æ¬¡æˆ‘ä»¬è¿˜æƒ³è¦ç»§ç»­ push çš„è¿™ä¸ªè¿œç«¯åˆ†æ”¯çš„æ—¶å€™æ¨é€å‘½ä»¤å°±å¯ä»¥ç®€å†™æˆ `git push` å³å¯

### Github Action è‡ªåŠ¨éƒ¨ç½²

> åŸºç¡€éƒ¨ç½²è¯·å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://vuepress.vuejs.org/zh/guide/deploy.html#github-pages)ï¼Œè¿™é‡Œåªä»‹ç»ä½¿ç”¨ Github Actions çš„é›†æˆéƒ¨ç½²ã€‚

GitHub Actions æ˜¯ä¸€ç§æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ (CI/CD) å¹³å°ï¼Œå¯ç”¨äºè‡ªåŠ¨æ‰§è¡Œç”Ÿæˆã€æµ‹è¯•å’Œéƒ¨ç½²ç®¡é“ã€‚ æ‚¨å¯ä»¥åˆ›å»ºå·¥ä½œæµç¨‹æ¥æ„å»ºå’Œæµ‹è¯•å­˜å‚¨åº“çš„æ¯ä¸ªæ‹‰å–è¯·æ±‚ï¼Œæˆ–å°†åˆå¹¶çš„æ‹‰å–è¯·æ±‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

å¯é…ç½® GitHub Actions å·¥ä½œæµï¼Œä½¿å…¶åœ¨å­˜å‚¨åº“ä¸­å‘ç”Ÿäº‹ä»¶ï¼ˆä¾‹å¦‚æ‰“å¼€æ‹‰å–è¯·æ±‚æˆ–åˆ›å»ºé—®é¢˜ï¼‰æ—¶è§¦å‘ ã€‚ å·¥ä½œæµåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¯æŒ‰é¡ºåºæˆ–å¹¶è¡Œè¿è¡Œçš„ä½œä¸šã€‚ æ¯ä¸ªä½œä¸šéƒ½å°†åœ¨å…¶è‡ªå·±çš„è™šæ‹Ÿæœºè¿è¡Œå™¨ä¸­æˆ–åœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œå¹¶å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ï¼Œç”¨äºè¿è¡Œå®šä¹‰çš„è„šæœ¬æˆ–è¿è¡ŒåŠ¨ä½œã€‚åŠ¨ä½œæ˜¯ä¸€ä¸ªå¯é‡ç”¨çš„æ‰©å±•ï¼Œå¯ç®€åŒ–å·¥ä½œæµ ã€‚

å…·ä½“å­¦ä¹ å¯å‚è€ƒï¼š

- [GitHub Actions å¿«é€Ÿå…¥é—¨ - GitHub æ–‡æ¡£](https://docs.github.com/zh/actions/quickstart)
- [GitHub Actions å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)](https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)

ä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²åï¼Œæˆ‘ä»¬å°†æ–‡æ¡£ push åˆ°è¿œç¨‹ä»“åº“çš„ä¸»åˆ†æ”¯æ—¶ï¼ŒGithub ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¯¹æ–‡æ¡£è¿›è¡Œæ‰“åŒ…å’Œå‘å¸ƒï¼Œä¸å†éœ€è¦æ‰‹åŠ¨è¿›å…¥åˆ°æ‰“åŒ…æ–‡ä»¶å¤¹ï¼Œå†æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚

1. ç”Ÿæˆ Tokenï¼š[ç®¡ç†ä¸ªäººè®¿é—®ä»¤ç‰Œ - GitHub Enterprise Server 3.7 Docs](https://docs.github.com/zh/enterprise-server@3.7/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)
1. é…ç½® Secretsï¼š
   1. è¿›å…¥ä½ å­˜æ”¾ä½ åšå®¢æºç çš„é¡¹ç›®ï¼Œç„¶åä¾æ¬¡ç‚¹å‡» Settings â†’ Secretsï¼Œ
   1. ç‚¹å‡»å³ä¸Šè§’çš„ New repository secretï¼Œæ–°å»ºä¸€ä¸ª Secretã€‚è¿™é‡Œçš„åå­—è¦å‘½åä¸º ACCESS_TOKENï¼Œç„¶å Value å°±æ˜¯æˆ‘ä»¬ä¸Šä¸€æ­¥ä¸­æ‰€ç”Ÿæˆçš„ Tokenã€‚
1. ç¼–å†™ Actionï¼šè¿›å…¥é¡¹ç›®çš„çš„ Actions é€‰é¡¹ï¼Œç„¶åæ–°å»ºä¸€ä¸ª workflowï¼Œé»˜è®¤æ–°å»ºçš„ workflow åå­—æ˜¯ `main.yml` ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š

```yaml
# deploy.yml
name: Build and Deploy

# ä»…åœ¨ main åˆ†æ”¯è¢« push æ—¶è§¦å‘
on: 
  push:
    branches:
       - main

# å…¨å±€ç¯å¢ƒå˜é‡
env:
  # ç”¨äºè®¾å®š LastUpdated çš„æ—¶åŒº
  TZ: 'Asia/Shanghai'
    
# ä»»åŠ¡
jobs:
  # ä»»åŠ¡ 1
  build-and-deploy:
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest
    steps:
    # æ‹‰å–ä»£ç 
    - name: Checkout
      uses: actions/checkout@master
      with:
        # ã€Œæœ€è¿‘æ›´æ–°æ—¶é—´ã€ ç­‰ git æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‹‰å–å…¨éƒ¨æäº¤è®°å½•
        fetch-depth: 0
        
    # ç”Ÿæˆé™æ€æ–‡ä»¶
    - name: Build
      run: yarn && yarn docs:build
      env:
        # work around for "error:0308010C:digital envelope routines::unsupported"
        NODE_OPTIONS: --openssl-legacy-provider
    
    # éƒ¨ç½²åˆ° GitHub Pages
    - name: Deploy
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        token: ${{ secrets.ACCESS_TOKEN }} # ä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„ secret
        branch: gh-pages # éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯ï¼Œå› ä¸º main åˆ†æ”¯å­˜æ”¾çš„ä¸€èˆ¬æ˜¯æºç ï¼Œè€Œ gh-pages åˆ†æ”¯åˆ™ç”¨æ¥å­˜æ”¾ç”Ÿæˆçš„é™æ€æ–‡ä»¶
        folder: docs/.vuepress/dist # vuepress ç”Ÿæˆçš„é™æ€æ–‡ä»¶å­˜æ”¾çš„åœ°æ–¹
```

ä¿å­˜ä¿®æ”¹å¹¶ commitï¼Œå°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚
